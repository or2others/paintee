!function(e){e.fn.htmlEmbed=function(t){function r(t){if("text"===o.output)e.each(t.results,function(){e(l).append(e(this.toString()).text())});else{var r="";e.each(t.results,function(){r+=this.toString()});var a=e('<div id="jquery-html-embed">'+r+"</div>"),s=document,n=s.getElementsByTagName("base")[0],h=n&&n.href,c=s.head||s.getElementsByTagName("head")[0],i=n||c.appendChild(s.createElement("base")),u=s.createElement("a");null!=o.base_href&&""!=o.base_href&&(a.find("a,area,link").attr("href",function(){return void 0!==e(this).attr("href")?(i.href=o.base_href,u.href=e(this).attr("href"),u.href):void 0}),a.find("iframe,img,input,script,source").attr("src",function(){return void 0!==e(this).attr("src")?(i.href=o.base_href,u.href=e(this).attr("src"),u.href):void 0})),null!=o.base_target&&a.find("a,form").attr("target",o.base_target),n?n.href=h:c.removeChild(i),e(l).html(a)}}function a(t){e(l).html("_error"===o.error?t:o.error),console.log(t)}var l=e(this),o=e.extend({},e.fn.htmlEmbed.defaults,t),s=(new Date).getTime();e(l).html(o.processing);var n="https:"===document.location.protocol?"https":"http",h={format:"xml",q:"select "+o.select+' from html where url="'+o.url+'" and compat="'+o.compat+'"'};if(null!=o.xpath&&""!=o.xpath&&(o.xpath=o.xpath.replace(/"/g,"'"),h.q+=' and xpath="'+o.xpath+'"'),console.log(h.q),null!=o.url&&""!=o.url){cache_key=o.url+o.select+o.xpath;var c=sessionStorage.getItem(cache_key);c=null!==c?JSON.parse(c):null,""==o.base_href&&(o.base_href=o.url),null!==c&&(new Date).getTime()-c._<6e4*o.cache?(r(c.data),console.log("X-HTML-Embed-Cache-Control: Cache-hit sessionStorage"),console.log("Fetched "+c.data.results.length+" ("+o.select+') items from "'+o.url+'" where xpath = "'+o.xpath+'" in '+((new Date).getTime()-s)/1e3+" secs"),console.log("Output: "+o.output)):e.ajax({url:n+"://query.yahooapis.com/v1/public/yql?diagnostics=true&callback=jsonp_callback&_maxage="+60*o.cache,data:h,dataType:"jsonp",cache:!0,headers:{"Cache-Control":"max-age="+60*o.cache},jsonp:!1,jsonpCallback:"jsonp_callback",success:function(e){console.log(e),"undefined"==typeof e.query.diagnostics.url.error&&e.results.length>0?(sessionStorage.setItem(cache_key,JSON.stringify({_:(new Date).getTime(),data:e})),r(e),console.log("X-HTML-Embed-Cache-Control: Remote-fetch via YQL"),console.log("Fetched "+e.results.length+" ("+o.select+') items from "'+o.url+'" where xpath = "'+o.xpath+'" in '+((new Date).getTime()-s)/1e3+" secs"),console.log("Output: "+o.output)):"undefined"!=typeof e.query.diagnostics.url.error?(a("Error fetching ("+o.select+') from "'+o.url+'" where xpath = "'+o.xpath+'". Details logged.'),console.log(e.query.diagnostics.url)):0==e.results.length&&a("Error fetching ("+o.select+') from "'+o.url+'" where xpath = "'+o.xpath+'". No matching items')},error:function(e,t){a("Error fetching ("+o.select+') from "'+o.url+'" where xpath = "'+o.xpath+'". Details: '+t)}})}else a("No URL specified");return this},e.fn.htmlEmbed.defaults={select:"*",url:null,xpath:null,compat:"html5",output:"html",processing:"",error:"",cache:120,base_href:null,base_target:null}}(jQuery);
